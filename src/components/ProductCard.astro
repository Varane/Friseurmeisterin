---
import type { Product } from '@lib/products';
import { withBase } from '@lib/site';

interface Props {
  product: Product;
}

const { product } = Astro.props;
const primaryImage = product.images?.[0];
const productUrl = withBase(`/shop/${product.slug}`);
const buyEnabled = Boolean(product.paymentLinkUrl);
---
<article
  class="card flex h-full flex-col overflow-hidden"
  data-product-card
  data-category={product.category}
  data-price={product.priceEur}
  data-name={product.name.toLowerCase()}
  data-brand={product.brand.toLowerCase()}
>
  <a href={productUrl} class="block overflow-hidden">
    {primaryImage ? (
      <img
        src={withBase(primaryImage.src)}
        alt={primaryImage.alt}
        width="420"
        height="320"
        class="h-56 w-full object-cover transition duration-300 hover:scale-105"
        loading="lazy"
        decoding="async"
      />
    ) : (
      <div class="flex h-56 items-center justify-center bg-blush text-sm text-ink/60">
        PLACEHOLDER_PRODUCT_IMAGE
      </div>
    )}
  </a>
  <div class="flex flex-1 flex-col p-5">
    <div class="flex items-start justify-between gap-2">
      <div>
        <h3 class="text-lg font-semibold">
          <a class="focus-ring" href={productUrl}>{product.name}</a>
        </h3>
        <p class="text-xs uppercase tracking-[0.15em] text-ink/50">{product.brand}</p>
      </div>
      <span class="text-sm font-semibold">€ {product.priceEur.toFixed(2)}</span>
    </div>
    <p class="mt-3 text-sm text-ink/70">{product.shortDescription}</p>
    <div class="mt-4 flex items-center justify-between text-xs text-ink/60">
      <span>{product.category}</span>
      <span>{product.inStock ? 'Verfügbar' : 'Nicht verfügbar'}</span>
    </div>
    <div class="mt-5 flex gap-3">
      <a
        class="rounded-full border border-ink/20 px-4 py-2 text-xs font-semibold text-ink focus-ring"
        href={productUrl}
      >
        Details
      </a>
      {buyEnabled ? (
        <a
          class="rounded-full bg-accent px-4 py-2 text-xs font-semibold text-white hover:bg-accent/90 focus-ring"
          href={product.paymentLinkUrl}
        >
          Buy now
        </a>
      ) : (
        <span
          class="rounded-full border border-ink/10 px-4 py-2 text-xs font-semibold text-ink/40"
          aria-disabled="true"
        >
          Checkout nicht konfiguriert
        </span>
      )}
    </div>
  </div>
</article>
